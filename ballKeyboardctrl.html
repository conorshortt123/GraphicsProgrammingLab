<!DOCTYPE html>

<html>

<script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
  <head>
    <meta charset="UTF-8">
    <title>Canvas</title>

    <style type="text/css">
		canvas {
			border: 1px solid grey; 
		}
    </style>

  </head>

  <body>
    <h4>CONTROLS</h4>
    <p>
    -WSAD to increase speed in respective direction.
    <br>-SPACE to change rotation direction.
    <br>-Double click to reposition.
    <br>-R to increase rotational velocity & T to decrease.
    </p>

    <canvas id="canvas-for-ball"></canvas>

    <script type="text/javascript">
		// Gets a handle to the element with id canvasOne.
		var canvas = document.getElementById("canvas-for-ball");
		// Get a 2D context for the canvas.
		var ctx = canvas.getContext("2d");
		// Make the fill style red.
		ctx.fillStyle = "rgb(255, 0, 0)";
		
		//Variables & Constants
	    const width = 300;
	    const height = 150;
	    const radius = 10;
	    var x, y, xspeed, yspeed, rotateSpeed;
		const gravity = 0.1;
		var a, b;
		var circleRadian = 2;
		var middleBottom = 0.5;
		var middleTop = 1.5;
		var line1Radian = 0.25;
		var line2Radian = 0.75;
		
		var color;
		var mass = 1;
		var num;
		var distance;
		
		//Ball class
		class Ball {
			constructor(x, y, xspeed, yspeed, rotateSpeed, mass, color, num) {
				this.x = x;
				this.y = y;
				this.xspeed = xspeed;
				this.yspeed = yspeed;
				this.rotateSpeed = rotateSpeed;
				this.mass = mass;
				this.color = color;
				this.num = num;
			}
			draw(){
				ctx.beginPath();
				//Circle
				ctx.arc(this.x, this.y, radius, 0, circleRadian * Math.PI);
				//Middle Line
				ctx.moveTo(this.x, this.y);
				a = (radius * Math.cos(Math.PI * middleBottom) + this.x);
				b = radius * Math.sin(Math.PI * middleBottom);
				ctx.lineTo(a, (b+this.y));
				ctx.moveTo(this.x, this.y);
				a = (radius * Math.cos(Math.PI * middleTop) + this.x);
				b = radius * Math.sin(Math.PI * middleTop);
				ctx.lineTo(a, (b+this.y));
				//First 45 degree line
				a = (radius * Math.cos(Math.PI * line1Radian) + this.x);
				b = radius * Math.sin(Math.PI * line1Radian);
				ctx.moveTo(this.x, this.y);
				ctx.lineTo(a, (b +this.y));
				//Second
				a = (radius * Math.cos(Math.PI * line2Radian) + this.x);
				b = radius * Math.sin(Math.PI * line2Radian);
				ctx.moveTo(this.x, this.y);
				ctx.lineTo(a, (b +this.y));		
				ctx.lineWidth = 2;
				
				switch(this.num){
					case 1:
						this.color = 'red';
						break;
					case 2:
						this.color = 'green';
						break;
					case 3:
						this.color = 'blue';
						break;
					case 4:
						this.color = 'yellow';
						break;
				}
				
				ctx.strokeStyle = this.color;
				ctx.stroke();
			}
			move(){
				// Update the y location.
				this.y += this.yspeed;
				//gravity is const
				this.yspeed += gravity;
				if(this.y > (height-radius)) {
					this.yspeed *= -1;
                    this.yspeed *= 0.9;
                    if(this.yspeed > -0.9){
                        this.yspeed = 0;
                        this.rotateSpeed = 0;
                        this.xspeed *= 0.99;
                    }
				} else if(this.y < radius) {
					this.yspeed *= -1;
				}
				// Update the x location.
				this.x += this.xspeed;
				if(this.x > 290) {
					this.xspeed *= -1;
				} else if(this.x < radius) {
					this.xspeed *= -1;
				}
			}
			rotate(){
				circleRadian += this.rotateSpeed;
				line1Radian += this.rotateSpeed;
				line2Radian += this.rotateSpeed;
				middleTop += this.rotateSpeed;
				middleBottom += this.rotateSpeed;
			}
		}
		
        var randX = Math.floor(Math.random() * (width - 20));
        var randY = Math.floor(Math.random() * (height - 20));
		
		num = Math.ceil(Math.random() * 3);
		var b1 = new Ball(randX, randY, 1.5, 0, 0.01, 2, 0, num);
        var b2 = new Ball(200, 100, 1, 0, 0.01, 2, 0, 4);
		
		//keypresses with jQuery
		function repeatme() {
			ctx.clearRect(0, 0, width, height);

			b1.draw();
			b1.move();
			b1.rotate();
                   
            b2.draw();
			b2.move();
			b2.rotate();
			
			checkCollisions();
			
			window.requestAnimationFrame(repeatme);
		}
		
		function checkCollisions() {
			var x3 = b2.x - b1.x;
			var y3 = b2.y - b1.y;
			var x3sqrd = Math.pow(x3, 2);
			var y3sqrd = Math.pow(y3, 2);
			var radiiSum = radius * 2;
			
			distance = Math.sqrt(x3sqrd + y3sqrd);
			if(distance < radiiSum){
				console.log("collision");
				
			}
		}
		
		repeatme();
		
		//KEYBOARD CONTROLS
		$(document.body).on('keydown', function(e2) {
			console.log(e2.which);
			switch (e2.which) {
            // key code for space key
			case 32:
				b1.rotateSpeed *= -1;
				b2.rotateSpeed *= -1;
				break;
			// key code for a key
			case 65:
				console.log('a key pressed!');
				b1.xspeed -= 1;
				b2.xspeed -= 1;
				break;
			// key code for d key
			case 68:
				console.log('d key pressed!');
				b1.xspeed += 1;
				b2.xspeed += 1;
				break;
			// key code for w key
			case 87:
				console.log('w key pressed!');
				b1.yspeed -= 1;
				b2.yspeed -= 1;
				break;
			// key code for s key
			case 83:
				console.log('s key pressed!');
				b1.yspeed += 1;
				b2.yspeed += 1;
				break;
            case 82:
                console.log('r key pressed!');
                b1.rotateSpeed += 0.001;
                b2.rotateSpeed += 0.001;
				break;
            case 84:
                console.log('t key pressed!');
                b1.rotateSpeed -= 0.001;
                b2.rotateSpeed -= 0.001;
				break;
            
           }	
			
		});
		
		//MOUSE CONTROL
		
		var canvasPos = {
			x: canvas.offsetLeft,
			y: canvas.offsetTop
		}
		
		//DOUBLE CLICK EVENT
		$( "#canvas-for-ball" ).dblclick(function() {
			var mouse = {
				x:event.pageX - canvasPos.x,
				y:event.pageY - canvasPos.y
			}
			
			ctx.clearRect(0, 0, width, height);
			b1.x = (mouse.x);
			b1.y = (mouse.y);
			b1.xspeed = 1;
			b1.yspeed = 1;
            b1.rotateSpeed = 0.01;
            
            b2.x = (mouse.x);
			b2.y = (mouse.y);
			b2.xspeed = 1.4;
			b2.yspeed = 1.4;
            b2.rotateSpeed = 0.01;
		});
    </script>

  </body>

</html>