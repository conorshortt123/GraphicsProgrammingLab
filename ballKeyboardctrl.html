<!DOCTYPE html>

<html>

<script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
  <head>
    <meta charset="UTF-8">
    <title>Canvas</title>

    <style type="text/css">
		canvas {
			border: 1px solid grey; 
		}
    </style>

  </head>

  <body>
    <h4>CONTROLS</h4>
    <p>
    -WSAD to increase speed in respective direction.
    <br>-SPACE to change rotation direction.
    <br>-Double click to reposition.
    <br>-R to increase rotational velocity & T to decrease.
    </p>

    <canvas id="canvas-for-ball"></canvas>

    <script type="text/javascript">
		// Gets a handle to the element with id canvasOne.
		var canvas = document.getElementById("canvas-for-ball");
		// Get a 2D context for the canvas.
		var ctx = canvas.getContext("2d");
		// Make the fill style red.
		ctx.fillStyle = "rgb(255, 0, 0)";
		
		//Variables & Constants
	    const width = 300;
	    const height = 150;
	    const radius = 10;
	    var x, y, xspeed, yspeed, rotateSpeed;
		const gravity = 0.1;
		var a, b;
		var circleRadian = 2;
		var middleBottom = 0.5;
		var middleTop = 1.5;
		var line1Radian = 0.25;
		var line2Radian = 0.75;
		
		//Ball class
		class Ball {
			constructor(x, y, xspeed, yspeed, rotateSpeed) {
				this.x = x;
				this.y = y;
				this.xspeed = xspeed;
				this.yspeed = yspeed;
				this.rotateSpeed = rotateSpeed;
			}
			draw(){
				ctx.beginPath();
				//Circle
				ctx.arc(this.x, this.y, radius, 0, circleRadian * Math.PI);
				//Middle Line
				ctx.moveTo(this.x, this.y);
				a = (radius * Math.cos(Math.PI * middleBottom) + this.x);
				b = radius * Math.sin(Math.PI * middleBottom);
				ctx.lineTo(a, (b+this.y));
				ctx.moveTo(this.x, this.y);
				a = (radius * Math.cos(Math.PI * middleTop) + this.x);
				b = radius * Math.sin(Math.PI * middleTop);
				ctx.lineTo(a, (b+this.y));
				//First 45 degree line
				a = (radius * Math.cos(Math.PI * line1Radian) + this.x);
				b = radius * Math.sin(Math.PI * line1Radian);
				ctx.moveTo(this.x, this.y);
				ctx.lineTo(a, (b +this.y));
				//Second
				a = (radius * Math.cos(Math.PI * line2Radian) + this.x);
				b = radius * Math.sin(Math.PI * line2Radian);
				ctx.moveTo(this.x, this.y);
				ctx.lineTo(a, (b +this.y));
				
				ctx.lineWidth = 2;
				ctx.stroke();
			}
			move(){
				// Update the y location.
				this.y += this.yspeed;
				this.yspeed += gravity;
				if(this.y > (height-radius)) {
					this.yspeed *= -1;
                    this.yspeed *= 0.9;
                    if(this.yspeed > -0.9){
                        this.yspeed = 0;
                        this.rotateSpeed = 0;
                        this.xspeed *= 0.99;
                    }
                    console.log(this.yspeed);
				} else if(this.y < radius) {
					this.yspeed *= -1;
				}
				// Update the x location.
				this.x += this.xspeed;
				if(this.x > 290) {
					this.xspeed *= -1;
				} else if(this.x < radius) {
					this.xspeed *= -1;
				}
			}
			rotate(){
				circleRadian += this.rotateSpeed;
				line1Radian += this.rotateSpeed;
				line2Radian += this.rotateSpeed;
				middleTop += this.rotateSpeed;
				middleBottom += this.rotateSpeed;
			}
		}
		
        var randX = Math.floor(Math.random() * 300);
        var randY = Math.floor(Math.random() * 100);
        
		var theBall = new Ball(randX, randY, 1, 0, 0.01);
        var otherBall = new Ball(200, 100, 1.5, 0, 0.01);
		
		//keypresses with jQuery
		function repeatme() {
			ctx.clearRect(0, 0, width, height);

			theBall.draw();
			theBall.move();
			theBall.rotate();
                   
            otherBall.draw();
			otherBall.move();
			otherBall.rotate();
			
			window.requestAnimationFrame(repeatme);
		}
		repeatme();
		
		$(document.body).on('keydown', function(e2) {
			console.log(e2.which);
			switch (e2.which) {
            // key code for space key
			case 32:
				theBall.rotateSpeed *= -1;
				break;
			// key code for a key
			case 65:
				console.log('a key pressed!');
				theBall.xspeed -= 1;
				break;
			// key code for d key
			case 68:
				console.log('d key pressed!');
				theBall.xspeed += 1;
				break;
			// key code for w key
			case 87:
				console.log('w key pressed!');
				theBall.yspeed -= 1;
				break;
			// key code for s key
			case 83:
				console.log('s key pressed!');
				theBall.yspeed += 1;
				break;
            case 82:
                console.log('r key pressed!');
                theBall.rotateSpeed += 0.001;
                break;
            case 84:
                console.log('t key pressed!');
                theBall.rotateSpeed -= 0.001;
                break;
            
           }	
			
		});
		
		var canvasPos = {
			x: canvas.offsetLeft,
			y: canvas.offsetTop
		}
		
		$( "#canvas-for-ball" ).dblclick(function() {
			var mouse = {
				x:event.pageX - canvasPos.x,
				y:event.pageY - canvasPos.y
			}
			
			ctx.clearRect(0, 0, width, height);
			theBall.x = (mouse.x);
			theBall.y = (mouse.y);
			theBall.xspeed = 1;
			theBall.yspeed = 1;
            theBall.rotateSpeed = 0.01;
            
            otherBall.x = (mouse.x);
			otherBall.y = (mouse.y);
			otherBall.xspeed = 1.4;
			otherBall.yspeed = 1.4;
            otherBall.rotateSpeed = 0.01;
		});
    </script>

  </body>

</html>